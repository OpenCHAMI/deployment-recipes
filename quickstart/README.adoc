= PCS with Sushy-tools

== Steps

. Deploy a debian 12
. Clone the repository
+
[source, shell]
----
sudo apt update -y
sudo apt install -y jq git
git clone --branch work-in-progress https://github.com/t-h2o/deployment-recipes
ln -s "${HOME}/deployment-recipes/quickstart/" "${HOME}"
cd quickstart
----

. Setup libvirt with
+
[source, shell]
----
bash libvirt/setup-libvirt.sh
----
+
NOTE: logout, login for the group

. Create a virtual node with
+
[source, shell]
----
bash libvirt/virtual-node.sh
----

. Install docker with
+
[source, shell]
----
bash install-docker.sh
----
+
NOTE: logout, login for the group

. Create sushy-emulator folder
+
[source, shell]
----
bash rfe-sushy-emulator.sh
----

. Run openchami services
+
[source, shell]
----
make run
----

. Add ssh key to sushy-emulator
+
[source, shell]
----
docker exec x1000c0s0b5 bash -c "ssh-keyscan \"$(docker network inspect bridge -f '{{range .IPAM.Config}}{{.Gateway}}{{end}}')\" > /root/.ssh/known_hosts"
----

. Add sushy-emulator as RFE
+
[source, shell]
----
curl -X POST -d '{"RedfishEndpoints":[{
  "ID":"x1000c0s0b5",
  "FQDN":"x1000c0s0b5",
  "RediscoverOnUpdate":true,
  "User":"root",
  "Password":"root_password"
}]}' http://localhost:27779/hsm/v2/Inventory/RedfishEndpoints
----

. Switch state off
+
NOTE: Follow logs of `x1000c0s0b5`, `smd` and `pcs`.
+
[source, shell]
----
bash transition.sh x1000c0s0b5 off
bash transition.sh x1000c0s0b5 on
----
+
NOTE: smd logs print nothings while x1000c0s0b3 does
