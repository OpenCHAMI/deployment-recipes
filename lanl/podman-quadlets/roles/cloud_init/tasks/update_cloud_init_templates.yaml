### check if content of template has changed
- block: 
  - name: '{{ tmplt.name }} | Get cloud-init content'
    set_fact:
      group_cloud_init_content: >-
        {%- if 'file' in existing_cloud_init_content[tmplt.name] -%}
        {{ existing_cloud_init_content[tmplt.name].file.content }}
        {%- else -%}
        "group has no 'file' data"
        {%- endif -%}
  
  - name: '{{ tmplt.name }} | Get inventory content'
    set_fact:
      group_inventory_content: '{{ tmplt.file.content | b64encode }}'
  
  - name: '{{ tmplt.name }} | Set changed if contents do not match'
    set_fact:
      cloud_init_changed: true
    when: group_cloud_init_content != group_inventory_content

- name: '{{ tmplt.name }} | Update existing cloud-init templates'
  ansible.builtin.uri:
    url: '{{ ochami_cloud_init_url }}/admin/groups/{{ tmplt.name }}'
    method: "PUT"
    status_code:
      - 200
      - 201
    headers:
      Authorization: 'Bearer {{ access_token.stdout }}'
    body_format: json
    body:
      '{{ tmplt }}'
  changed_when: cloud_init_changed
  when:
    - cloud_init_changed | default(false) | bool
